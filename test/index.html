<html>
<head>
  <title>KeyDown event interference test</title>
  <link rel="stylesheet" type="text/css" href="testsuite.css">
  <script src="jquery.js"></script>
  <script src="testrunner.js"></script>
  <script>
    function press(elem, keyCode, charCode) {
        var ev = document.createEvent('KeyboardEvent');
        ev.initKeyEvent('keypress', true, true, null,
                false, false, false, false,
                keyCode, charCode);
        return elem.dispatchEvent(ev);
    }

    var afterPressTabCb;
    function pressTab(afterCb) {
        stop(7000);
        afterPressTabCb = afterCb;
        window.addEventListener("keyup", afterPressTab, false);
        alert("Please close this dialog and press TAB");
    }
    function afterPressTab(event) {
        window.removeEventListener("keyup", afterPressTab, false);
        equals(event.keyCode, 9, "TAB keyboard press expected");
        afterPressTabCb();
        start();
    }

    $(function() {
        test("Tab inserts tab", function() {
            $("#ta").val("abc").focus();
            pressTab(function() {
                equals($("#ta").val(), "abc\t", "Textarea gets TAB inserted");
            });
        });
        test("Tab does not insert for one-row textarea", function() {
            $("#rows-ta").val("def").focus();
            pressTab(function() {
                equals($("#rows-ta").val(), "def", "Textarea should be skipped");
            });
        });
        /* keydown-interference not needed so far
        test("KeyDown interference", function() {
            $("#keydown-ta").val("abc");
            $("#prevField").focus();
            pressTab(function() {
                equals($("#keydown-ta").val(), "abc", "Textarea is ontouched");
            });
        });*/
    });
    /* keydown-interference not needed so far
    function keydownHandler(event) {
        if (event.keyCode == 9) $("#keydown-ta").focus();
        event.preventDefault();
    }*/
  </script>
</head>
<body>

<!-- QUnit placeholders -->
<h1>Tabinta QUnit tests</h1>
<h2 id="banner"></h2>
<h2 id="userAgent"></h2>
<ol id="tests"></ol>
<div id="main"></div>

<form id="simple-form">
  <textarea id="ta"></textarea>
  <input>
</form>

<form id="rows-form">
  <textarea id="rows-ta" rows="1" cols="40"></textarea>
  <input>
</form>

<!-- keydown-interference not needed so far
form id="keydown-form">
  <input id="prevField" onkeydown="return keydownHandler(event)">
  <textarea id="keydown-ta"></textarea>
</form-->

</body>
</html>
